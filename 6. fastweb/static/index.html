<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SteamSAGE</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --bg1:#1b2838;
  --bg2:#171a21;
  --card: rgba(42,71,94,0.55);
  --accent:#66c0f4;
  --accent2:#4fc3f7;
  --text:#c7d5e0;
  --muted:#9fd3ff;
  --border: rgba(102,192,244,0.15);
}

body {
  margin: 0;
  font-family: system-ui;
  background: linear-gradient(135deg, var(--bg1), var(--bg2));
  color: var(--text);
}

.container {
  max-width: 1100px;
  margin: auto;
  padding: 40px;
}

h1 {
  text-align: center;
  font-size: 2.4rem;
  color: var(--accent);
}

.search input {
  width: 100%;
  padding: 14px;
  border-radius: 10px;
  border: none;
  font-size: 1rem;
}

button {
  width: 100%;
  margin-top: 16px;
  padding: 14px;
  background: var(--accent2);
  border: none;
  border-radius: 10px;
  font-weight: 800;
  cursor: pointer;
}

.grid {
  margin-top: 40px;
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
  gap: 20px;
}

.card {
  background: var(--card);
  border-radius: 12px;
  border: 1px solid var(--border);
  overflow: hidden;
  cursor: pointer;
  user-select: none;
  transition: .2s;
}

.card:hover {
  transform: translateY(-2px);
  box-shadow: 0 12px 30px rgba(0,0,0,.3);
}

.card img {
  width: 100%;
  height: 190px;
  object-fit: cover;
}

.content {
  padding: 14px;
  display: flex;
  flex-direction: column;
  height: 100%;
}

.title {
  font-weight: 900;
  font-size: 1.1rem;
  color: #fff;
}

.score {
  background: var(--accent);
  color: var(--bg1);
  padding: 4px 10px;
  border-radius: 999px;
  display: inline-block;
  font-size: 0.8rem;
  margin: 8px 0;
}

.desc {
  font-size: 0.9rem;
  opacity: .9;
}

.actions {
  margin-top: auto;
  display: flex;
  gap: 10px;
}

.actions a {
  flex: 1;
  text-align: center;
  padding: 10px;
  border-radius: 10px;
  font-weight: 900;
  text-decoration: none;
}

.actions .primary {
  background: var(--accent2);
  color: var(--bg1);
}

.actions .secondary {
  background: rgba(255,255,255,.08);
  color: var(--text);
}

/* MODAL */
.modalOverlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.65);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 999;
}

.modal {
  background: #0e131b;
  width: min(1000px, 95vw);
  max-height: 90vh;
  border-radius: 16px;
  overflow: hidden;
}

.modalHeader {
  display: flex;
  justify-content: space-between;
  padding: 14px;
  border-bottom: 1px solid rgba(255,255,255,.1);
}

.modalBody {
  padding: 16px;
}

.closeBtn {
  background: rgba(255,255,255,.1);
  border: none;
  padding: 8px 14px;
  color: #fff;
  border-radius: 10px;
  cursor: pointer;
}
</style>
</head>

<body>

<div class="container">
  <h1>ðŸŽ® SteamSAGE</h1>

  <div class="search">
    <input id="query" placeholder="open world survival crafting">
    <button onclick="runSearch()">Find Games</button>
  </div>

  <div class="grid" id="results"></div>
</div>

<!-- MODAL -->
<div class="modalOverlay" id="modalOverlay">
  <div class="modal">
    <div class="modalHeader">
      <strong id="modalTitle">Game</strong>
      <button class="closeBtn" onclick="closeModal()">Close âœ•</button>
    </div>
    <div class="modalBody" id="modalBody"></div>
  </div>
</div>

<script>
const resultsEl = document.getElementById("results");
const modalOverlay = document.getElementById("modalOverlay");
const modalTitle = document.getElementById("modalTitle");
const modalBody = document.getElementById("modalBody");

window.__searchResults = [];

function openModalFromIndex(idx){
  const g = window.__searchResults[idx];
  modalTitle.textContent = g.name;
  modalBody.innerHTML = `
    <p><strong>Match:</strong> ${(g.similarity_score*100).toFixed(1)}%</p>
    <p>${g.description}</p>
    <a href="${g.steam_url}" target="_blank">View on Steam â†’</a>
  `;
  modalOverlay.style.display = "flex";
}

function closeModal(){
  modalOverlay.style.display = "none";
}

modalOverlay.addEventListener("click", e => {
  if (e.target === modalOverlay) closeModal();
});

async function runSearch(){
  const res = await fetch("/search", {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({ query: document.getElementById("query").value, top_k: 6 })
  });

  const data = await res.json();
  window.__searchResults = data;

  resultsEl.innerHTML = data.map((g, idx) => `
    <div class="card" onclick="openModalFromIndex(${idx})">
      <img src="${g.header_image}">
      <div class="content">
        <div class="title">${g.name}</div>
        <div class="score">${(g.similarity_score*100).toFixed(1)}% Match</div>
        <div class="desc">${g.description}</div>

        <div class="actions">
          <a class="primary"
             href="${g.steam_url}"
             target="_blank"
             onclick="event.stopPropagation()">View on Steam</a>

          <a class="secondary"
             href="https://www.youtube.com/results?search_query=${encodeURIComponent(g.name + ' gameplay')}"
             target="_blank"
             onclick="event.stopPropagation()">Gameplay</a>
        </div>
      </div>
    </div>
  `).join("");
}
</script>

</body>
</html>
